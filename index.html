<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pac-Man</title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      color: white;
      font-family: Arial, sans-serif;
    }

    #game {
      position: relative;
      width: 504px;
      height: 504px;
      background: #222;
      display: grid;
      grid-template-columns: repeat(24, 20px);
      grid-template-rows: repeat(24, 20px);
      gap: 2px;
      margin-bottom: 20px;
    }

    .cell {
      width: 20px;
      height: 20px;
      background: #111;
      border-radius: 3px;
      position: relative;
    }

    .wall { background: blue; }
    .pacman {
      border-radius: 50%;
      z-index: 10;
      transition: background 0.2s ease;
    }
    .pacman.powered { background: orange !important; }

    .dot {
      position: absolute;
      top: 7px;
      left: 7px;
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
    }

    .fruit {
      position: absolute;
      top: 5px;
      left: 5px;
      width: 10px;
      height: 10px;
      background: orange;
      border-radius: 50%;
      z-index: 8;
      box-shadow: 0 0 5px #ff6600;
    }

    .ghost {
      width: 20px;
      height: 20px;
      position: relative;
      z-index: 9;
    }

    .ghost img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .ghost.vulnerable img {
      filter: hue-rotate(180deg) brightness(0.7);
    }

    #status {
      font-size: 1.2rem;
      height: 1.5em;
      margin-bottom: 5px;
    }

    #score {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    #colorMenu {
      margin-bottom: 10px;
      font-size: 1rem;
      color: white;
    }

    #colorSelect {
      margin-left: 10px;
      padding: 5px;
      font-size: 1rem;
      border-radius: 4px;
      background: #222;
      color: white;
      border: 1px solid #555;
    }

    button {
      background: #444;
      border: none;
      color: white;
      font-size: 1rem;
      padding: 10px 20px;
      margin: 0 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    button:hover { background: #666; }

    #buttons {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    #touch-controls {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }

    #touch-controls .row {
      display: flex;
      justify-content: center;
    }

    .dir-btn {
      background: #333;
      color: white;
      font-size: 1.5rem;
      padding: 15px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .dir-btn:active {
      background: #666;
    }

    @media (max-width: 768px) {
      #touch-controls {
        display: flex;
      }
    }
  </style>
</head>
<body>

<div id="game"></div>
<div id="score">Pontuação: 0</div>
<div id="status"></div>

<div id="colorMenu">
  <label for="colorSelect">Cor do Pac-Man:</label>
  <select id="colorSelect">
    <option value="yellow" selected>Amarelo</option>
    <option value="green">Verde</option>
    <option value="blue">Azul</option>
    <option value="red">Vermelho</option>
    <option value="pink">Rosa</option>
  </select>
</div>

<div id="buttons">
  <button id="startBtn">Jogar</button>
  <button id="speedBtn" style="display:none;">Acelerar Fantasmas</button>
  <button id="restartBtn" style="display:none;">Reiniciar</button>
</div>

<div id="touch-controls">
  <div class="row">
    <button class="dir-btn" data-dir="up">⬆️</button>
  </div>
  <div class="row">
    <button class="dir-btn" data-dir="left">⬅️</button>
    <button class="dir-btn" data-dir="down">⬇️</button>
    <button class="dir-btn" data-dir="right">➡️</button>
  </div>
</div>

<script>
const width = 24;
let layout = [], cells = [], pacmanPosition, ghosts = [];
let gameOver = false, ghostInterval, score = 0, ghostSpeed = 500;
let poweredUp = false, powerTimeout;
let pacmanColor = 'yellow';

const game = document.getElementById('game');
const status = document.getElementById('status');
const scoreDisplay = document.getElementById('score');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const speedBtn = document.getElementById('speedBtn');
const colorSelect = document.getElementById('colorSelect');

colorSelect.addEventListener('change', () => {
  pacmanColor = colorSelect.value;
  drawPacman();
});

const fruitPositions = [3*width+3, 3*width+20, 20*width+3, 20*width+20, 12*width+12];

function createLayout() {
  layout = [];
  for(let i=0;i<width*width;i++){
    const row = Math.floor(i/width), col = i%width;
    layout.push((row===0||row===width-1||col===0||col===width-1) ? 1 : 2);
  }
  [6,12,18].forEach(r=>{ for(let c=2;c<width-2;c++){ layout[r*width+c]=1; } });
  [6,12,18].forEach(c=>{ for(let r=2;r<width-2;r++){ layout[r*width+c]=1; } });
  layout[1*width+1]=0; layout[1*width+2]=0;
  fruitPositions.forEach(pos=>layout[pos]=3);
}

function createGrid(){
  game.innerHTML=''; cells=[];
  layout.forEach(value=>{
    const cell = document.createElement('div'); cell.classList.add('cell');
    if(value===1) cell.classList.add('wall');
    if(value===2){ const dot=document.createElement('div'); dot.classList.add('dot'); cell.appendChild(dot); }
    if(value===3){ const fruit=document.createElement('div'); fruit.classList.add('fruit'); cell.appendChild(fruit); }
    game.appendChild(cell); cells.push(cell);
  });
}

function drawPacman(){
  const cell = cells[pacmanPosition];
  cell.classList.add('pacman');
  cell.style.backgroundColor = poweredUp ? 'orange' : pacmanColor;
}

function removePacman(){
  const cell = cells[pacmanPosition];
  cell.classList.remove('pacman','powered');
  cell.style.backgroundColor = '';
}

class Ghost {
  constructor(startPos, colorClass, imgSrc){
    this.startPos=startPos; this.position=startPos;
    this.vulnerable=false; this.isDead=false;
    this.element=document.createElement('div'); this.element.classList.add('ghost',colorClass);
    this.img=document.createElement('img'); this.img.src=imgSrc; this.element.appendChild(this.img);
    cells[this.position].appendChild(this.element);
  }
  move(){
    if(this.isDead) return;
    const directions=[-1,1,-width,width];
    function manhattanDist(a,b){
      const x1=a%width,y1=Math.floor(a/width),x2=b%width,y2=Math.floor(b/width);
      return Math.abs(x1-x2)+Math.abs(y1-y2);
    }
    let validMoves=directions.filter(d=>{
      const newPos=this.position+d;
      return newPos>=0&&newPos<layout.length&&layout[newPos]!==1&&!ghosts.some(g=>g.position===newPos&&g!==this&&!g.isDead);
    });
    if(validMoves.length===0) return;
    validMoves.sort((a,b)=>{
      const distA=manhattanDist(this.position+a,pacmanPosition);
      const distB=manhattanDist(this.position+b,pacmanPosition);
      return this.vulnerable?distB-distA:distA-distB;
    });
    const bestMove=validMoves[0];
    cells[this.position].removeChild(this.element);
    this.position+=bestMove;
    cells[this.position].appendChild(this.element);
  }
  makeVulnerable(){ this.vulnerable=true; this.element.classList.add('vulnerable'); }
  makeNormal(){ this.vulnerable=false; this.element.classList.remove('vulnerable'); }
  kill(){
    this.isDead=true; this.makeNormal();
    if(this.element.parentNode) this.element.parentNode.removeChild(this.element);
    setTimeout(()=>{ this.isDead=false; this.position=this.startPos; cells[this.position].appendChild(this.element); },5000);
  }
  remove(){ if(this.element.parentNode) this.element.parentNode.removeChild(this.element); }
}

function startGhosts(){
  stopGhosts();
  ghostInterval=setInterval(()=>{
    if(gameOver) return;
    ghosts.forEach(ghost=>{
      if(ghost.isDead) return;
      ghost.move();
      if(ghost.position===pacmanPosition){
        if(poweredUp && ghost.vulnerable){ updateScore(100); ghost.kill(); }
        else if(!poweredUp){ endGame('Você foi pego pelos fantasmas!'); }
      }
    });
  },ghostSpeed);
}

function stopGhosts(){ clearInterval(ghostInterval); }

function updateScore(points){ score+=points; scoreDisplay.textContent='Pontuação: '+score; }

function endGame(msg){
  gameOver=true; stopGhosts(); status.textContent=msg;
  restartBtn.style.display='inline-block'; speedBtn.style.display='none'; startBtn.style.display='none';
}

function resetGame(){
  gameOver=false; score=0; updateScore(0); status.textContent=''; poweredUp=false;
  clearTimeout(powerTimeout); createLayout(); createGrid();
  pacmanPosition=1*width+1; ghosts.forEach(g=>g.remove()); ghosts=[];
  ghosts.push(new Ghost(22*width+22,'red','fan4.png'));
  ghosts.push(new Ghost(22*width+1,'pink','fan3.png'));
  ghosts.push(new Ghost(1*width+22,'cyan','fan2.png'));
  ghosts.push(new Ghost(12*width+12,'orange','fan.png'));
  drawPacman();
  restartBtn.style.display='none'; speedBtn.style.display='inline-block'; startBtn.style.display='none';
  startGhosts();
}

function movePacman(dir){
  if(gameOver) return;
  const newPos=pacmanPosition+dir;
  if(newPos<0||newPos>=layout.length||layout[newPos]===1) return;
  removePacman(); pacmanPosition=newPos;

  if(layout[pacmanPosition]===2){ layout[pacmanPosition]=0; const dot=cells[pacmanPosition].querySelector('.dot'); if(dot) dot.remove(); updateScore(10); }
  if(layout[pacmanPosition]===3){ layout[pacmanPosition]=0; const fruit=cells[pacmanPosition].querySelector('.fruit'); if(fruit) fruit.remove(); updateScore(50); activatePowerUp(); }

  drawPacman();

  ghosts.forEach(ghost=>{
    if(ghost.position===pacmanPosition){
      if(poweredUp && ghost.vulnerable){ updateScore(100); ghost.kill(); }
      else if(!poweredUp){ endGame('Você foi pego pelos fantasmas!'); }
    }
  });

  if(!layout.includes(2) && !layout.includes(3)){ endGame('Você ganhou! Parabéns!'); }
}

function activatePowerUp(){
  poweredUp=true; drawPacman(); ghosts.forEach(g=>{ if(!g.isDead) g.makeVulnerable(); });
  if(powerTimeout) clearTimeout(powerTimeout);
  powerTimeout=setTimeout(()=>{ poweredUp=false; drawPacman(); ghosts.forEach(g=>g.makeNormal()); },8000);
}

// --- Teclado ---
document.addEventListener('keydown',e=>{
  if(gameOver) return;
  switch(e.key){
    case 'ArrowUp': case 'w': case 'W': movePacman(-width); break;
    case 'ArrowDown': case 's': case 'S': movePacman(width); break;
    case 'ArrowLeft': case 'a': case 'A': movePacman(-1); break;
    case 'ArrowRight': case 'd': case 'D': movePacman(1); break;
  }
});

// --- Botões virtuais ---
document.querySelectorAll('.dir-btn').forEach(btn => {
  btn.addEventListener('touchstart', () => {
    const dir = btn.dataset.dir;
    if(dir === 'up') movePacman(-width);
    if(dir === 'down') movePacman(width);
    if(dir === 'left') movePacman(-1);
    if(dir === 'right') movePacman(1);
  });
});

// --- Swipe (arrastar com o dedo) ---
let touchStartX = 0, touchStartY = 0;
let touchEndX = 0, touchEndY = 0;

function handleSwipe() {
  const dx = touchEndX - touchStartX;
  const dy = touchEndY - touchStartY;

  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 30) movePacman(1);      // direita
    else if (dx < -30) movePacman(-1); // esquerda
  } else {
    if (dy > 30) movePacman(width);     // baixo
    else if (dy < -30) movePacman(-width); // cima
  }
}

document.addEventListener("touchstart", e => {
  touchStartX = e.changedTouches[0].screenX;
  touchStartY = e.changedTouches[0].screenY;
}, false);

document.addEventListener("touchend", e => {
  touchEndX = e.changedTouches[0].screenX;
  touchEndY = e.changedTouches[0].screenY;
  handleSwipe();
}, false);

startBtn.addEventListener('click', resetGame);
restartBtn.addEventListener('click', resetGame);
speedBtn.addEventListener('click', ()=>{
  ghostSpeed=ghostSpeed===500?250:500;
  speedBtn.textContent=ghostSpeed===500?'Acelerar Fantasmas':'Normalizar Velocidade';
  startGhosts();
});
</script>

</body>
</html>


